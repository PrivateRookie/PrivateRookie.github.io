<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>typing+pyright-æ›´æ­£ç¡®çš„Pythonä»£ç  - å¤œé›¨ç§‹ç¯å½•</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../å¯¼è¨€.html">å¯¼è¨€</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../æ–‡ç« .html"><strong aria-hidden="true">1.</strong> æ–‡ç« </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../posts/2018-06-24-openstackåˆ›å»ºè™šæ‹Ÿæœºæºç é˜…è¯».html"><strong aria-hidden="true">1.1.</strong> openstackåˆ›å»ºè™šæ‹Ÿæœºæºç é˜…è¯»</a></li><li class="chapter-item expanded "><a href="../posts/2018-06-27-Bottle-æ¡†æ¶ä¸­è£…é¥°å™¨ç±»å’Œæè¿°ç¬¦åº”ç”¨.html"><strong aria-hidden="true">1.2.</strong> Bottle-æ¡†æ¶ä¸­è£…é¥°å™¨ç±»å’Œæè¿°ç¬¦åº”ç”¨</a></li><li class="chapter-item expanded "><a href="../posts/2019-04-17-ä½¿ç”¨devpiæ­å»ºæœ¬åœ°æº.html"><strong aria-hidden="true">1.3.</strong> ä½¿ç”¨devpiæ­å»ºæœ¬åœ°æº</a></li><li class="chapter-item expanded "><a href="../posts/2019-04-20-Pythonå±•å¼€åµŒå¥—åºåˆ—.html"><strong aria-hidden="true">1.4.</strong> Pythonå±•å¼€åµŒå¥—åºåˆ—</a></li><li class="chapter-item expanded "><a href="../posts/2019-04-20-pipenv-ä½¿ç”¨ç®€ä»‹.html"><strong aria-hidden="true">1.5.</strong> pipenv-ä½¿ç”¨ç®€ä»‹</a></li><li class="chapter-item expanded "><a href="../posts/2019-04-22-æ·±åº¦ç³»ç»Ÿrustå¼€å‘ç¯å¢ƒæ­å»º.html"><strong aria-hidden="true">1.6.</strong> æ·±åº¦ç³»ç»Ÿrustå¼€å‘ç¯å¢ƒæ­å»º</a></li><li class="chapter-item expanded "><a href="../posts/2019-05-01-miniserve-miniserveç®€å•ç¾è§‚çš„æ–‡ä»¶æœåŠ¡å™¨.html"><strong aria-hidden="true">1.7.</strong> miniserve-miniserveç®€å•ç¾è§‚çš„æ–‡ä»¶æœåŠ¡å™¨</a></li><li class="chapter-item expanded "><a href="../posts/2019-05-05-magnum-stein-release-new-features.html"><strong aria-hidden="true">1.8.</strong> magnum-stein-release-new-features</a></li><li class="chapter-item expanded "><a href="../posts/2019-05-12-rust-rc.html"><strong aria-hidden="true">1.9.</strong> rust-rc</a></li><li class="chapter-item expanded "><a href="../posts/2019-05-20-Python-Rust-è¿­ä»£å™¨ç±»æ¯”.html"><strong aria-hidden="true">1.10.</strong> Python-Rust-è¿­ä»£å™¨ç±»æ¯”</a></li><li class="chapter-item expanded "><a href="../posts/2019-06-28-æ­å»ºetcdæœåŠ¡å‘ç°æœåŠ¡.html"><strong aria-hidden="true">1.11.</strong> æ­å»ºetcdæœåŠ¡å‘ç°æœåŠ¡</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-03-OpenStackå…è®¸rootç”¨æˆ·ä½¿ç”¨ssh-keyç™»å½•.html"><strong aria-hidden="true">1.12.</strong> OpenStackå…è®¸rootç”¨æˆ·ä½¿ç”¨ssh-keyç™»å½•</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-06-requirements.txtæ–‡ä»¶æŒ‡å®šä¾èµ–.html"><strong aria-hidden="true">1.13.</strong> requirements.txtæ–‡ä»¶æŒ‡å®šä¾èµ–</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-10-æˆ‘ç»å¸¸ä½¿ç”¨çš„Rustå°crate.html"><strong aria-hidden="true">1.14.</strong> æˆ‘ç»å¸¸ä½¿ç”¨çš„Rustå°crate</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-14-Rustæ¨¡å—ä¸æ–‡ä»¶.html"><strong aria-hidden="true">1.15.</strong> Rustæ¨¡å—ä¸æ–‡ä»¶</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-18-Deepinå®‰è£…Angular10+.html"><strong aria-hidden="true">1.16.</strong> Deepinå®‰è£…Angular10+</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-25-ä½¿ç”¨OSProfiler.html"><strong aria-hidden="true">1.17.</strong> ä½¿ç”¨OSProfiler</a></li><li class="chapter-item expanded "><a href="../posts/2019-07-27-windowsä¸Šä½¿ç”¨vscode-remote.html"><strong aria-hidden="true">1.18.</strong> windowsä¸Šä½¿ç”¨vscode-remote</a></li><li class="chapter-item expanded "><a href="../posts/2019-08-04-ä½¿ç”¨rust-analyzer.html"><strong aria-hidden="true">1.19.</strong> ä½¿ç”¨rust-analyzer</a></li><li class="chapter-item expanded "><a href="../posts/2019-08-16-Python-packageå®‰è£…æ—¶å®‰è£…é¢å¤–æ–‡ä»¶.html"><strong aria-hidden="true">1.20.</strong> Python-packageå®‰è£…æ—¶å®‰è£…é¢å¤–æ–‡ä»¶</a></li><li class="chapter-item expanded "><a href="../posts/2019-08-31-Rust-å‘½ä»¤è¡Œå·¥å…·.html"><strong aria-hidden="true">1.21.</strong> Rust-å‘½ä»¤è¡Œå·¥å…·</a></li><li class="chapter-item expanded "><a href="../posts/2019-09-27-Fedora-CoreOS-å°é²œ.html"><strong aria-hidden="true">1.22.</strong> Fedora-CoreOS-å°é²œ</a></li><li class="chapter-item expanded "><a href="../posts/2020-01-31-rustä»£ç é£æ ¼tips.html"><strong aria-hidden="true">1.23.</strong> rustä»£ç é£æ ¼tips</a></li><li class="chapter-item expanded "><a href="../posts/2020-02-03-log4rs-Rust-logåº“.html"><strong aria-hidden="true">1.24.</strong> log4rs-Rust-logåº“</a></li><li class="chapter-item expanded "><a href="../posts/2020-02-29-impl-Trait-vs-dyn-Trait.html"><strong aria-hidden="true">1.25.</strong> impl-Trait-vs-dyn-Trait</a></li><li class="chapter-item expanded "><a href="../posts/2020-03-04-nom-cheatsheet.html"><strong aria-hidden="true">1.26.</strong> nom-cheatsheet</a></li><li class="chapter-item expanded "><a href="../posts/2020-03-09-gitlab-runnerå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹.html"><strong aria-hidden="true">1.27.</strong> gitlab-runnerå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</a></li><li class="chapter-item expanded "><a href="../posts/2020-03-21-ä½¿ç”¨nomå†™parser.html"><strong aria-hidden="true">1.28.</strong> ä½¿ç”¨nomå†™parser</a></li><li class="chapter-item expanded "><a href="../posts/2020-05-10-ä½¿ç”¨nomå†™parser.html"><strong aria-hidden="true">1.29.</strong> ä½¿ç”¨nomå†™parser</a></li><li class="chapter-item expanded "><a href="../posts/2020-06-07-ä½¿ç”¨nomå†™parser.html"><strong aria-hidden="true">1.30.</strong> ä½¿ç”¨nomå†™parser</a></li><li class="chapter-item expanded "><a href="../posts/2020-06-25-Rustå®ç°çš„æ—¥è‡³æ”¶é›†å·¥å…·.html"><strong aria-hidden="true">1.31.</strong> Rustå®ç°çš„æ—¥è‡³æ”¶é›†å·¥å…·</a></li><li class="chapter-item expanded "><a href="../posts/2020-07-19-typing+pyright-æ›´æ­£ç¡®çš„Pythonä»£ç .html" class="active"><strong aria-hidden="true">1.32.</strong> typing+pyright-æ›´æ­£ç¡®çš„Pythonä»£ç </a></li><li class="chapter-item expanded "><a href="../posts/2020-07-31-boxercrabå‘å¸ƒ.html"><strong aria-hidden="true">1.33.</strong> boxercrabå‘å¸ƒ</a></li><li class="chapter-item expanded "><a href="../posts/2020-08-16-ä½¿ç”¨nomå†™parser.html"><strong aria-hidden="true">1.34.</strong> ä½¿ç”¨nomå†™parser</a></li><li class="chapter-item expanded "><a href="../posts/2020-08-30-PowerShellé…ç½®.html"><strong aria-hidden="true">1.35.</strong> PowerShellé…ç½®</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../ç¬”è®°.html"><strong aria-hidden="true">2.</strong> ç¬”è®°</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../notes/rust/2021-10-31-åµŒå¥—è§£æ„.html"><strong aria-hidden="true">2.1.</strong> åµŒå¥—è§£æ„</a></li><li class="chapter-item expanded "><a href="../notes/rust/2021-11-06-æœªèƒ½ææ—©é‡Šæ”¾çš„RefCell.html"><strong aria-hidden="true">2.2.</strong> æœªæå‰é‡Šæ”¾çš„å¼•ç”¨</a></li><li class="chapter-item expanded "><a href="../notes/rust/2022-02-09-serdeæ”¶é›†æœªçŸ¥å­—æ®µ.html"><strong aria-hidden="true">2.3.</strong> serdeæ”¶é›†æœªçŸ¥å­—æ®µ</a></li><li class="chapter-item expanded "><a href="../notes/rust/2022-02-17-ç¼–è¯‘æœŸç¡®å®šæŸä¸ªç±»å‹æ˜¯ä¸æ˜¯Option.html"><strong aria-hidden="true">2.4.</strong> å¦‚ä½•åœ¨ç¼–è¯‘æœŸç¡®å®šæŸä¸ªç±»å‹æ˜¯ä¸æ˜¯ Option</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">å¤œé›¨ç§‹ç¯å½•</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="typingpyright-æ›´æ­£ç¡®çš„pythonä»£ç "><a class="header" href="#typingpyright-æ›´æ­£ç¡®çš„pythonä»£ç ">typing+pyright-æ›´æ­£ç¡®çš„Pythonä»£ç </a></h1>
<hr />
<p>è¿™ä¸€é˜µåœ¨å…¬å¸å†…éƒ¨å†™ä¸€ä¸ªå°é¡¹ç›®ï¼Œé€»è¾‘ä¸å¤æ‚ï¼Œä½†æ•°æ®ç±»å‹æ­£ç¡®éå¸¸é‡è¦ã€‚æœ€å¼€å§‹å› ä¸ºå†…ç½‘ä¸­çš„ vscode ç‰ˆæœ¬å¤ªä½ï¼Œåªå¼€äº†æœ€åŸºæœ¬çš„ Python æ’ä»¶ã€‚
åæ¥å› ä¸º vscode ç‰ˆæœ¬å‡çº§ï¼Œæˆ‘ä¾¿å¯ç”¨äº† pyright æ’ä»¶ï¼Œæ‰“å¼€å vscode æ»¡çœ¼çº¢è‰²æ³¢æµªçº¿ï¼Œä»”ç»†æŸ¥çœ‹æŠ¥é”™åŸå› ï¼Œå¾ˆå¤šæŠ¥é”™éƒ½æ˜¯æˆ‘æ²¡æœ‰å¤„ç†è¿”å›å€¼ <code>None</code> å¯¼è‡´çš„ï¼Œæœ€åæˆ‘ä¿®å¤äº†è‡³å°‘4ä¸ªéšè— bugã€‚
ç»è¿‡å‡ æ¬¡ä½¿ç”¨ï¼Œæˆ‘è§‰å¾—ç±»å‹æç¤ºæ˜¯ Python 3 ä»…æ¬¡äº Union code, async await å¼‚æ­¥å‡½æ•°çš„ä¼˜ç§€åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªå€¼å¾—è®¤çœŸå­¦ä¹ çš„æ–°ç‰¹æ€§ã€‚é…åˆ vscode + pyright æ’ä»¶ï¼Œå¯ä»¥å†™å‡ºå¯è¯»æ€§å’Œç»´æŠ¤æ€§æ›´é«˜çš„ä»£ç ã€‚
å¯æƒœç±»å‹æç¤ºåœ¨ç¤¾åŒºä¸­å‘å±•ç¼“æ…¢ï¼Œè®¨è®ºåº¦ä¼¼ä¹æ²¡æœ‰é‚£ä¹ˆé«˜ã€‚</p>
<p>åœ¨ Python 3 ç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬å‘å¸ƒå‰ï¼Œ2006å¹´ <a href="https://www.python.org/dev/peps/pep-3107/">PEP 3107</a> å‡½æ•°æ³¨è§£çš„ææ¡ˆè¢«å‘èµ·å¹¶äº Python 3 ä¸­å®ç°ã€‚
è¿™ä¸ªåè®®å…è®¸åœ¨å‡½æ•°ç­¾åä¸­ç›´æ¥æ·»åŠ å‚æ•°å’Œè¿”å›å€¼æ³¨é‡Šï¼Œè€Œä¸æ˜¯æŠŠå®ƒä»¬å†™åœ¨å‡½æ•°çš„ doc string é‡Œã€‚å¦‚</p>
<pre><code class="language-python">def compile(source: &quot;something compilable&quot;,
            filename: &quot;where the compilable thing comes from&quot;,
            mode: &quot;is this a single statement or a suite?&quot;):
    pass
</code></pre>
<p>å¾ˆè‡ªç„¶çš„ï¼ŒåŸºäºè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨æ³¨è§£è¯´æ˜æœŸæœ›çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ï¼Œå¦‚</p>
<pre><code class="language-python">def haul(item: Haulable, *vargs: PackAnimal) -&gt; Distance:
    pass
</code></pre>
<p>ä½†ç›´åˆ°2014å¹´ <a href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a> ææ¡ˆæ‰æ­£å¼ç¡®å®šäº† <code>type hints</code> å³ç±»å‹æç¤ºçš„è¯­æ³•ï¼Œå¹¶åœ¨ Python 3.5 ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚
ä¹Ÿæ˜¯åœ¨åŒä¸€å¹´ï¼Œ typescript æ­£å¼å‘å¸ƒï¼Œä¸ç›®å‰å¤§çº¢å¤§ç´«çš„ typescript ä¸åŒï¼Œç±»å‹æç¤ºåœ¨ Python ç¤¾åŒºå¥½åƒæ²¡æœ‰æ€èµ·é£æµªï¼Œæœºå™¨å­¦ä¹ å’ŒAIé£å¤´æ­£ç››ï¼Œæ²¡å¤šå°‘äººæ³¨æ„åˆ°è¿™ä¸ªä»æ„æƒ³åˆ°å®ç°èŠ±äº†8å¹´çš„æ–°ç‰¹æ€§ã€‚</p>
<h2 id="åŸºæœ¬ä½¿ç”¨"><a class="header" href="#åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</a></h2>
<p>éœ€è¦ Python 3.5+, æ¯ä¸ªå¤§ç‰ˆæœ¬ typing éƒ½ä¼šå‘å¸ƒæ–°ç‰¹æ€§ï¼Œå› æ­¤å»ºè®® Python ç‰ˆæœ¬è¶Šæ–°è¶Šå¥½ã€‚
æ¥ç€æ˜¯ vscode, å®‰è£…å®˜æ–¹çš„ Python æ’ä»¶å’Œ <a href="https://marketplace.visualstudio.com/items?itemName=ms-pyright.pyright">pyright</a>, pyright å¢å¼ºäº† vscode å¯¹ Python ç±»å‹æç¤ºçš„æ”¯æŒã€‚</p>
<p>å‡½æ•°æ³¨è§£æ”¯æŒä½¿ç”¨åŸºæœ¬ç±»å‹</p>
<pre><code class="language-python">def add(x: int, y: int) -&gt; int:
    &quot;&quot;&quot; add operation &quot;&quot;&quot;
    return x + y
</code></pre>
<p>å°†é¼ æ ‡æ‚¬åœåœ¨å‡½æ•°åä¸Šä¼šæ˜¾ç¤ºå‚æ•°ç±»å‹å’Œå‡½æ•°è¯´æ˜</p>
<p><img src="../assets/2020_07_18/def_add.png" alt="add" /></p>
<p>å¦‚æœä½ ä¼ å…¥ä¸åŒç±»å‹çš„å‚æ•°ï¼Œpyright ä¼šæç¤ºä½ å‚æ•°ç±»å‹ä¸åŒ¹é…</p>
<p><img src="../assets/2020_07_18/add_wrong_param.png" alt="wrong param type" /></p>
<p>ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»ä¹Ÿå¯ä»¥ä½œä¸ºç±»å‹æç¤º</p>
<pre><code class="language-python">class Cat:
    def __init__(self, name):
        self.name = name


def cat_factory(name: str) -&gt; Cat:
    &quot;&quot;&quot; create a cat !&quot;&quot;&quot;
    return Cat(name)
</code></pre>
<p>æŸäº›æƒ…å†µä¸‹ä¸€äº›ç±»å‹è¿˜æ²¡å®šä¹‰æˆ–åœ¨å‡½æ•°å®šä¹‰æ—¶å¯¼å…¥è¯¥ç±»å‹ä¼šå¯¼è‡´å¾ªç¯å¯¼å…¥ï¼Œæ­¤æ—¶å¯ä»¥ç”¨å­—ç¬¦ä¸²ä»£æ›¿ç±»å‹ã€‚
æ¯”å¦‚æˆ‘æŠŠ Cat å®šä¹‰æ”¾åˆ° cat_factory åé¢ï¼Œæ­¤æ—¶ pyright ä¼šæç¤º Cat unbound</p>
<p><img src="../assets/2020_07_18/cat_unbound.png" alt="cat_unbound" /></p>
<p>å°†å‡½æ•°å®šä¹‰æ”¹ä¸º</p>
<pre><code class="language-python">def cat_factory(name: str) -&gt; 'Cat':
    &quot;&quot;&quot; create a cat !&quot;&quot;&quot;
    return Cat(name)
</code></pre>
<p>å³å¯ä¿®å¤ pyright æŠ¥é”™ã€‚</p>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æŸä¸€è¡Œæœ«å°¾ä½¿ç”¨ <code># type: ignore</code> æ³¨é‡Šæç¤º pyright å¿½ç•¥æ­¤è¡Œç±»å‹æ£€æŸ¥ã€‚</p>
<p>è™½ç„¶ä¸Šé¢ä¸‰ä¸ªåŠŸèƒ½å·²ç»è®©æˆ‘ä»¬å‘å†™å‡ºæ­£ç¡®çš„ Python ä»£ç è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œpyright èƒ½æä¾›æ›´å¼ºç±»å‹æç¤ºåŠŸèƒ½ã€‚</p>
<h2 id="è¿›é˜¶ä½¿ç”¨"><a class="header" href="#è¿›é˜¶ä½¿ç”¨">è¿›é˜¶ä½¿ç”¨</a></h2>
<h3 id="optional"><a class="header" href="#optional">Optional</a></h3>
<p>ä½ å®šä¹‰äº†å¦‚ä¸‹å‡½æ•°ï¼Œpyright ä¼šæŠ¥é”™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-python">def judge(a: int, b: int) -&gt; str:
    if a &gt; b:
        return &quot;great&quot;
</code></pre>
<p><img src="../assets/2020_07_18/ret_type.png" alt="return type" /></p>
<p>å› ä¸ºå‡½æ•°ä¸­çš„ if å¯¼è‡´äº†å‡½æ•°è¿”å›å€¼æœ‰å¯èƒ½ä¸º <code>None</code>ï¼Œè¿™ä¸å‡½æ•°çš„ç±»å‹æç¤ºä¸ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ·»åŠ  else åˆ†æ”¯è¿”å›å­—ç¬¦ä¸²ï¼Œä¿®å¤è¿™ä¸ªæŠ¥é”™ã€‚
ä½†æœ‰æ—¶å€™å‡½æ•°å°±æ˜¯æœ‰å¯èƒ½è¿”å› None æˆ–è€…æŸä¸ªå€¼ï¼Œäº†è§£ Rust åº”è¯¥çŸ¥é“è¿™æ—¶å€™å¯ä»¥ç”¨ <code>Option&lt;T&gt;</code> æ¥è¡¨ç¤ºè¿”å›å€¼ç±»å‹ã€‚
Python çš„ç±»å‹æç¤ºä¹Ÿæä¾›äº†ç±»ä¼¼çš„ <a href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a> ç±»å‹ã€‚</p>
<p><code>Optional[T]</code> ç›¸å½“äº <code>T or None</code>, å¦‚æœç”¨è”åˆç±»å‹è¡¨ç¤ºå³ä¸º <code>Union[T, None]</code>ã€‚</p>
<p>å› æ­¤ä¸Šé¢çš„å‡½æ•°ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸º</p>
<pre><code class="language-python">from typing import Optional

def judge(a: int, b: int) -&gt; Optional[str]:
    if a &gt; b:
        return &quot;great&quot;
</code></pre>
<p>å½“å…¶ä»–å‡½æ•°ä½¿ç”¨ judge æ—¶ï¼ŒOptional ä¼šæç¤ºä½ ä¸è¦å¿˜äº†å¤„ç†è¿”å›å€¼ä¸º None çš„æƒ…å†µã€‚</p>
<p><img src="../assets/2020_07_18/none_ret.png" alt="none return" /></p>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨å†™å¤æ‚å‡½æ•°æ—¶éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å¿˜è®°åˆ¤æ–­æŸäº›åˆ†æ”¯æˆ–æå‰è¿”å›å¯¼è‡´è¿”å›å€¼å‡ºç°äº†é¢„æœŸä¹‹å¤–ç±»å‹çš„é”™è¯¯ã€‚</p>
<h3 id="union"><a class="header" href="#union">Union</a></h3>
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº† Union ç±»å‹ï¼Œé¡¾åæ€ä¹‰å®ƒè¡¨ç¤ºå¤šä¸ªç±»å‹çš„é›†åˆï¼ŒOptional ä¹Ÿåªæ˜¯å®ƒçš„ä¸€ä¸ªç‰¹ä¾‹ã€‚
æœ‰æ—¶å€™å‡½æ•°éœ€è¦å¤šç§ç±»å‹ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Unionã€‚</p>
<pre><code class="language-python">from typing import Union

def ret_multi(a: int, b: int) -&gt; Union[str, int]:
    if (a &gt;= b):
        return a - b
    else:
        return 'No!'
</code></pre>
<h3 id="æ›´ç²¾ç¡®çš„å¤åˆç±»å‹"><a class="header" href="#æ›´ç²¾ç¡®çš„å¤åˆç±»å‹">æ›´ç²¾ç¡®çš„å¤åˆç±»å‹</a></h3>
<p>å¯¹äº dict, list, tuple ç­‰å¯ä»¥åŒ…å«å…¶ä»–ç±»å‹çš„å¤åˆç±»å‹ï¼Œç®€å•çš„ dict, list ç±»å‹æç¤ºè¿˜ä¸èƒ½æ˜ç¡®è¯´æ˜å®ƒä»¬åŒ…å«çš„å…ƒç´ ç±»å‹ï¼Œ
å› æ­¤ typing æä¾›äº† <code>Dict</code>, <code>Tuple</code>ï¼Œ<code>List</code> ç­‰ç±»å‹ã€‚</p>
<pre><code class="language-python">from typing import List, Dict, Tuple, Union


# å£°æ˜ä¸€ä¸ª int åˆ—è¡¨
int_list: List[int] = [100, 100]

# å£°æ˜ä¸€ä¸ªé”®ä¸º str, å€¼ä¸º int çš„å­—å…¸
mapping: Dict[str, int] = {&quot;1&quot;: 1}

# å£°æ˜ä¸€ä¸ªå«æœ‰ä¸¤ä¸ª int å…ƒç´ çš„å…ƒç»„
corr_x_y: Tuple[int, int] = (1, 2)
# æ³¨æ„ pyright ä¼šæ£€æŸ¥å…ƒç»„é•¿åº¦ï¼Œå¦‚ä¸‹é¢çš„å¤åˆ¶ä¼šå¯¼è‡´ pyright æŠ¥é”™
corr_too_many: Tuple[int, int] = (1, 2, 3)
# å¦‚æœè¦è¡¨ç¤ºå¯å˜é•¿åº¦ï¼Œå¯ä»¥ç”¨ `...`
corr_var: Tuple[int, ...] = (1, 2, 3)

# å¦‚æœæœ‰å¤šç§å¯èƒ½çš„å…ƒç´ ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ `Union`
union_list: List[Union[int, str]] = [100, 'Good']
</code></pre>
<h3 id="å‡½æ•°ç±»å‹æç¤º"><a class="header" href="#å‡½æ•°ç±»å‹æç¤º">å‡½æ•°ç±»å‹æç¤º</a></h3>
<p>Python ç»å¸¸ç”¨åˆ°é«˜é˜¶å‡½æ•°ï¼Œå› æ­¤ï¼Œå¦‚ä½•åœ¨å‚æ•°å’Œè¿”å›å€¼ç±»å‹æç¤ºè¡¨è¾¾å‡½æ•°æ˜¯ç»å¸¸ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œ
ä¸ºæ­¤ typing æä¾›äº† <code>Callable</code></p>
<pre><code class="language-python">from typing import Callable,


def add(a: int, b: int) -&gt; int:
    return a + b

def apply(fn: Callable[[int, int], int], *args: int) -&gt; int:
    return fn(args[0], args[1])
</code></pre>
<p><code>Callable</code> å®šä¹‰ä¸º <code>[[å‚æ•°ç±»å‹, ...]ï¼Œ è¿”å›å€¼ç±»å‹]</code></p>
<h3 id="ç±»å‹åˆ«å"><a class="header" href="#ç±»å‹åˆ«å">ç±»å‹åˆ«å</a></h3>
<p>æœ‰æ—¶å€™ï¼ŒæŸäº›ç±»å‹ä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œæˆ–è€…ä½¿ç”¨åˆ«åä¼šæé«˜ä»£ç å¯è¯»æ€§æ—¶ï¼Œç±»å‹åˆ«åæ˜¯éå¸¸æœ‰ç”¨çš„æŠ€å·§ï¼Œ
ä»¥ä¸‹æ˜¯æ–‡æ¡£ä¸­çš„ä¾‹å­ã€‚é€šè¿‡ç±»å‹åˆ«åå®šä¹‰äº† <code>UserId</code>ï¼Œè€Œä¸” <code>ProUserId</code> ä¹Ÿèƒ½ä» <code>UserId</code> ä¸­
æ´¾ç”Ÿè€Œæ¥ã€‚</p>
<pre><code class="language-python">from typing import NewType

UserId = NewType('UserId', int)

ProUserId = NewType('ProUserId', UserId)
</code></pre>
<h2 id="å½©è›‹"><a class="header" href="#å½©è›‹">å½©è›‹</a></h2>
<p>Python çš„ç±»å‹æç¤ºå€Ÿé‰´äº†ä¸å°‘å…¶ä»–è¯­è¨€ç‰¹æ€§ï¼Œç†Ÿæ‚‰æŸäº›è¿™äº›è¯­è¨€çš„äººï¼Œçœ‹åˆ°è¿™äº›ç±»å‹æç¤ºï¼Œå¯èƒ½ä¼šå¿ƒä¸€ç¬‘ï¼Œè¿™ä¸æ˜¯ xx å—ã€‚</p>
<hr />
<p>æ¯”å¦‚ <code>final</code>ï¼ŒJava å’Œ C++ ä¸­çš„å…³é”®å­—ï¼Œè¿™é‡Œä»¥è£…é¥°å™¨å­˜åœ¨ï¼Œ æç¤ºæ­¤æ–¹æ³•ä¸å¯é‡è½½, ç”¨æˆ·ç±»æ—¶æç¤ºæ­¤ç±»ä¸å¯ç»§æ‰¿ã€‚</p>
<pre><code class="language-python">from typing import final

class Base:
    @final
    def done(self) -&gt; None:
        ...
class Sub(Base):
    def done(self) -&gt; None:  # Error reported by type checker
          ...

@final
class Leaf:
    ...
class Other(Leaf):  # Error reported by type checker
</code></pre>
<p>è¿˜æœ‰ <code>Any</code>, <del>TypeScript</del> AnyScript è¡¨ç¤ºè¿™æˆ‘ç†Ÿæ‚‰ã€‚
å¦‚æœä½ ä¸çŸ¥é“è¿”å›å€¼æˆ–è€…ç±»å‹æ˜¯ä»€ä¹ˆï¼Œç”¨ <code>Any</code> å§ï¼Œå½“ç„¶ï¼Œåæœè‡ªè´Ÿã€‚</p>
<hr />
<p><code>NoReturn</code> ç±»ä¼¼ Rust ä¸­çš„ <code>!</code> è¿”å›å€¼ç±»å‹ï¼Œæç¤ºè¿™ä¸ªå‡½æ•°æ°¸è¿œä¸ä¼šè¿”å›</p>
<pre><code class="language-python">from typing import NoReturn

def stop() -&gt; NoReturn:
    raise RuntimeError('no way')
</code></pre>
<hr />
<p><code>Literal</code> å³å­—é¢é‡ï¼Œå®ƒè¡¨ç¤ºç±»å‹æœ‰æ•ˆå€¼åº”è¯¥å’Œå­—é¢é‡ä¸€æ ·ã€‚æˆ‘è§‰å¾—å®ƒæœ€æœ‰ç”¨çš„åœ°æ–¹åœ¨äºè¡¨ç¤ºæœ‰äº›æšä¸¾å€¼æ—¶éå¸¸ç®€å•ã€‚
æ¯”å¦‚æ–‡ä»¶æ“ä½œæ—¶ <code>r</code>, <code>rb</code>, <code>w</code> flagï¼Œå®šä¹‰ä¸€ä¸ª Enum éå¸¸ç¹çï¼Œä½†ç”¨ä¸‹é¢çš„ä¾‹å­åˆ™éå¸¸ç®€å•æ–¹ä¾¿</p>
<pre><code class="language-python">from typing import Literal

MODE = Literal['r', 'rb', 'w', 'wb']
def open_helper(file: str, mode: MODE) -&gt; str:
    ...

open_helper('/some/path', 'r')  # æ­£ç¡®
open_helper('/other/path', 'typo')  # pyright æŠ¥é”™
</code></pre>
<hr />
<p>æœ€åæˆ‘è§‰å¾—åŠ äº†ç±»å‹æç¤ºçš„ Python ä¹ä¸€çœ‹å¾ˆ Rust ç›¸ä¼¼åº¦æŒºé«˜çš„ğŸ˜€ã€‚</p>
<p><img src="../assets/2020_07_18/rust_python.png" alt="rust &amp; python" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../posts/2020-06-25-Rustå®ç°çš„æ—¥è‡³æ”¶é›†å·¥å…·.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../posts/2020-07-31-boxercrabå‘å¸ƒ.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../posts/2020-06-25-Rustå®ç°çš„æ—¥è‡³æ”¶é›†å·¥å…·.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../posts/2020-07-31-boxercrabå‘å¸ƒ.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-138690523-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../lunr.zh.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
